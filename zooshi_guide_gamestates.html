<!-- HTML header for doxygen 1.8.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Zooshi: Game States</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,400italic,500,500italic,700,700italic|Roboto+Mono:400,700" rel="stylesheet">
<link href="style.css" rel="stylesheet" type="text/css"/>
<script>
  /**
   * Check if the browser rendering this page is being run on an Android device.
   * It checks if the string 'android' is found in the browser's `userAgent`.
   * @return {boolean} This returns `true` if the browser's `userAgent` contains
   * the string 'android' (indicating that the browser is on an Android device).
   * Otherwise, it returns `false`.
   */
  function isAndroidDevice() {
    if (navigator && navigator.userAgent) {
      return navigator.userAgent.toLowerCase().indexOf('android') != -1;
    } else {
      return false;
    }
  }
  /**
   * Check if an HTML `class` attribute is in the browser-specific format.
   * @param {string} An HTML `class` attribute in the format 'browser-{device}'.
   * @return {boolean} Returns `true` if `browserClass` was in the valid format,
   * prefixed with 'browser-'. Otherwise, it returns false.
   */
  function isBrowserSpecificClassName(browserClass) {
    if (browserClass && browserClass.substring(0, 8) == 'browser-' &&
        browserClass.length > 8) {
      return true;
    } else {
      return false;
    }
  }
  /**
   * Get all the HTML Elements with browser-specific `class` attributes.
   * @return {array} Returns an array of all the HTML Elements with a `class`
   * attribute that is prefixed with `browser-`.
   */
  function getAllBrowserSpecificElements() {
    if (document) {
      var htmlElements = document.getElementsByTagName("*");
      var browserSpecificElements = [];
      for (var i = 0; i < htmlElements.length; i++) {
        if (isBrowserSpecificClassName(htmlElements[i].className)) {
          browserSpecificElements.push(htmlElements[i]);
        }
      }
      return browserSpecificElements;
    } else {
      return null;
    }
  }
  /**
   * Given a browser-specific HTML `class` attribute, extract the device name.
   * @param {string} browserClass The string name of an HTML `class` attribute,
   * in the format `browser-{device}`.
   * @return {string} Returns a string containing only the device portion of
   * the class name. If the input was invalid, then it returns `null`.
   */
  function extractDeviceFromBrowserClass(browserClass) {
    if (isBrowserSpecificClassName(browserClass)) {
      return browserClass.substring(8);
    }
    else {
      return null;
    }
  }
  /**
   * Hide device specific elements that do not apply to the current device.
   */
  function handleDeviceSpecificLoading() {
    var browserSpecificElements = getAllBrowserSpecificElements();
    for (var i = 0; i < browserSpecificElements.length; i++) {
      var device = extractDeviceFromBrowserClass(browserSpecificElements[i].className);
      if (device && !isAndroidDevice() && device == 'android') {
        browserSpecificElements[i].innerHTML = '';
      } else if(device && isAndroidDevice() && device == 'desktop') {
        browserSpecificElements[i].innerHTML = '';
      }
    }
  }
  $(document).ready(handleDeviceSpecificLoading);
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="commonprojectlogo">
    <img alt="Logo" src="fpl_logo_small.png"/>
  </td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Zooshi
   </div>
   <div style="font-size:12px;">
	 An open source project by
     <a href="https://developers.google.com/games/#Tools">FPL</a>.
  </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="zooshi_guide_gameplay.html"><span>Gameplay</span></a></li>
      <li><a href="zooshi_guide_overview.html"><span>Programmer's&#160;Guide</span></a></li>
      <li><a href="zooshi_readme.html"><span>Readme</span></a></li>
      <li><a href="contributing.html"><span>Contributing</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('zooshi_guide_gamestates.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Game States </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="gamestates_introduction"></a>
Introduction</h1>
<p>This document outlines the state machine and the states used to control the flow of <a class="el" href="index.html#zooshi_index">Zooshi</a>, which are located in the <code>states</code> directory.</p>
<h1><a class="anchor" id="gamestates_statemachine"></a>
State Machine</h1>
<p>Zooshi uses a state machine to control the flow between its various states, including the menus, the game itself, and the in-game editor. Each state is in control of the game when active, implementing an <code>AdvanceFrame</code> call to advance the state every frame, and a <code>Render</code> call in order to render the state to screen. In order to change states, changes are made to the <code>next_state</code> variable, passed in during <code>AdvanceFrame</code>. Shared functions needed by the states, such as rendering the world, and updating the camera, are provided in <code>states_common.cpp</code>.</p>
<h2><a class="anchor" id="gamestates_loading"></a>
Loading State</h2>
<p>The initial state used while the game assets are being loaded. Note that the assets are not queued by the state itself, but instead in <code>game.cpp</code>, <code>InitializeAssets</code>. After the loading is complete, which is handled by <a href="http://google.github.io/fplbase">fplbase</a>'s <b>AssetManager</b>, the state transitions into the game menu state.</p>
<h2><a class="anchor" id="gamestates_game_menu"></a>
Game Menu State</h2>
<p>This state is used to manage the menus between games, powered by <a href="http://google.github.io/flatui">FlatUI</a>, which can be seen in <code>gui.cpp</code>. The menu manages the type of menu being displayed, and based on the input from FlatUI, transitions between them, the game, and exiting. This state also handles integration with <a href="http://developer.android.com/google/play-services/games.html">Google Play Game Services</a>.</p>
<h2><a class="anchor" id="gamestates_intro"></a>
Intro State</h2>
<p>This state is used when entering <a class="el" href="zooshi_guide_gameplay_cardboard.html">Cardboard gameplay</a>. By introducing a state between the menu and gameplay for Cardboard, it allows the user to place the device in Cardboard before the start of the game. It also allows the <a href="https://developers.google.com/cardboard/android/">Cardboard SDK</a> to be oriented based on the direction the player is facing when they leave the state, guaranteeing they will be facing in the correct direction on game start.</p>
<h2><a class="anchor" id="gamestates_gameplay"></a>
Gameplay State</h2>
<p>This state is used to control the <a class="el" href="zooshi_guide_gameplay.html">gameplay</a>, updating and rendering the world appropriately, for all types of <a class="el" href="zooshi_guide_controllers.html">input controllers</a>, including Cardboard. The state checks for the various state transitions that can occur from it, to the pause state, game over, or the in-game editor.</p>
<h2><a class="anchor" id="gamestates_pause"></a>
Pause State</h2>
<p>This state is used for pausing from the gameplay state, with the menus again using FlatUI, to either transition back into the game, or to the menu state.</p>
<h2><a class="anchor" id="gamestates_gameover"></a>
Gameover State</h2>
<p>This state is used when the game has finished, from not feeding enough patrons in the previous lap. A brief cutscene plays, using the <code>EndGameEvent</code> on patrons, after which it can return to the menu state. Note that when playing in Cardboard, it instead restarts the gameplay state, as the menu does not support being viewed while in Cardboard.</p>
<h2><a class="anchor" id="gamestates_scene_lab"></a>
Scene Lab State</h2>
<p>This state handles the in-game editor, which is powered by <a href="http://google.github.io/scene_lab">Scene Lab</a>, and can be entered by pressing <b>F10</b> from the gameplay state. This state updates the Scene Lab, and upon exit returns back to the gameplay state, preserving the changes that where made to the game.</p>
<p><br/>
 </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-46159502-1', 'google.github.io');
ga('send', 'pageview');
</script>
</body>
</html>
